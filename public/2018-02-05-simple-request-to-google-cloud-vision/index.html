<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <meta name="generator" content="Hugo 0.64.0" />

  
  <meta name="description" content="Applied data science breadcrumbs">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="http://notsoformal.xyz/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="http://notsoformal.xyz/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="http://notsoformal.xyz/favicon-16x16.png">

  
  <link rel="manifest" href="http://notsoformal.xyz/site.webmanifest">

  
  <link rel="mask-icon" href="http://notsoformal.xyz/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="http://notsoformal.xyz/css/bootstrap.min.css" />

  <link rel="stylesheet" href="http://notsoformal.xyz/css/xcode.css" rel="stylesheet" id="theme-stylesheet">
  <script src="http://notsoformal.xyz/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  
  <title>Labels Detection w/ Google Cloud Vision | Not So Formal</title>
  

  <style>
 
@font-face {
    font-family: 'PT Sans';
    font-style: normal;
    font-weight: 400;
    src: url('../fonts/pt-sans-v11-latin-regular.eot');  
    src: local('PT Sans'), local('PTSans-Regular'),
         url('../fonts/pt-sans-v11-latin-regular.eot?#iefix') format('embedded-opentype'),  
         url('../fonts/pt-sans-v11-latin-regular.woff2') format('woff2'),  
         url('../fonts/pt-sans-v11-latin-regular.woff') format('woff'),  
         url('../fonts/pt-sans-v11-latin-regular.ttf') format('truetype'),  
         url('../fonts/pt-sans-v11-latin-regular.svg#PTSans') format('svg');  
  }

small a {
    opacity: 0.5;
    color: #000;
}

body {
  min-width: 300px;
  font-family: "PT Sans"
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block;
  padding: 18px 0;
  margin-right: 1em;
  font-weight: bold;
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none;
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #ffffff;
}



body {
  color: #000;
}



a {
  color: #E71D36;
}



a:hover,
a:focus {
  color: #FF9F1C;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: #FFF;
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: #FF9F1C;
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 2px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #E2E2E2;
   
  border-radius: 4px;
  box-shadow: 5px 5px 5px grey;
}

pre code {
  padding: 0;
  font-size: 1em;
  color: inherit;
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 2px;
  color: #E71D36;
  background-color: #f5f5f5;
   
  border-radius: 4px;
  font-size: .7em;
  font-family: monospace;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>

</head>


<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">notsoformal</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Labels Detection w/ Google Cloud Vision</h1>
<p>
  <small class="text-secondary">
  
  
  Feb 5, 2018
  </small>
  

<small><a href="http://notsoformal.xyz/tags/httr">#httr</a></small>


<small><a href="http://notsoformal.xyz/tags/gcp">#gcp</a></small>


</p>



<p>A quick 10 on using <code>Google Cloud Vision REST API</code> to perform data analysis on images.</p>
<p>Endpoint</p>
<blockquote>
<p><a href="https://vision.googleapis.com/v1/images:annotate" class="uri">https://vision.googleapis.com/v1/images:annotate</a></p>
</blockquote>
<div id="authentication" class="section level3">
<h3>Authentication</h3>
<p>First you must authenticate your requests. There are 2 ways to do it.</p>
<ol style="list-style-type: decimal">
<li><a href="https://support.google.com/cloud/answer/6158862?hl=en">Using an API key</a></li>
<li><a href="https://cloud.google.com/iam/docs/creating-managing-service-accounts#creating_a_service_account">Using A Service Account</a></li>
</ol>
</div>
<div id="request-body-and-responses" class="section level3">
<h3>Request Body and Responses</h3>
<p>The body of your POST request contains a JSON object, containing a single requests list, which itself contains one or more objects of type <code>AnnotateImageRequest</code>.</p>
<pre class="json"><code>{
  &quot;requests&quot;:[
    {
      &quot;image&quot;:{
        &quot;content&quot;:&quot;/9j/7QBEUGhvdG9...image contents...eYxxxzj/Coa6Bax//Z&quot;
      },
      &quot;features&quot;:[
        {
          &quot;type&quot;:&quot;LABEL_DETECTION&quot;,
          &quot;maxResults&quot;:1
        }
      ]
    }
  ]
}</code></pre>
<p>Full documentation <a href="https://cloud.google.com/vision/docs/reference/rest/v1/images/annotate">here</a>.</p>
</div>
<div id="providing-the-image" class="section level3">
<h3>Providing The Image</h3>
<p>Several ways to do this as well,</p>
<ol style="list-style-type: decimal">
<li>Base64-encoded image string</li>
<li>Google Cloud Storage URI</li>
<li>Public Accessible Image</li>
</ol>
</div>
<div id="json-response-format" class="section level3">
<h3>JSON Response Format</h3>
<p>The annotate request receives a JSON response of type AnnotateImageResponse. Although the requests are similar for each feature type, the responses for each feature type can be quite different. Consult the Vision API Reference for complete information.</p>
</div>
<div id="a-quick-demo" class="section level3">
<h3>A Quick Demo</h3>
<pre class="r"><code># Specify image url
imgURI &lt;- &quot;http://upload.wikimedia.org/wikipedia/commons/thumb/b/bd/
Rembrandt_van_Rijn_-_Self-Portrait_-_Google_Art_Project.jpg/
463px-Rembrandt_van_Rijn_-_Self-Portrait_-_Google_Art_Project.jpg&quot;

# Specify endpoint mentioned above
endpoint &lt;- &quot;https://vision.googleapis.com/v1/images:annotate&quot;

# Set API token in R environment
# options(gcv_api_token = &quot;&quot;)

if(!is.null(getOption(&quot;gcv_api_token&quot;))){
  baseURI &lt;- paste0(endpoint, &quot;?key=&quot;, getOption(&quot;gcv_api_token&quot;))
}else{
  stop(&quot;API token not set&quot;)
}

# Post request body
body &lt;- sprintf(&#39;{
        &quot;requests&quot;:[
            {
                &quot;image&quot;:{
                    &quot;source&quot;:{
                        &quot;imageUri&quot;:
                            &quot;%s&quot;
                    }
                },
                &quot;features&quot;:[
                    {
                        &quot;type&quot;:&quot;LABEL_DETECTION&quot;,
                        &quot;maxResults&quot;:%i
                    }
                    ]
            }
            ]
        }&#39;, imgURI, 10
                )

# Send request
res &lt;- httr::POST(baseURI, body = body, encode = &quot;json&quot;, config = httr::verbose())

# Extract content (specific mime type)yhat
lbs &lt;- httr::content(res, type = &quot;application/json&quot;)

# Convert result to data frame
lbs$responses[[1]]$labelAnnotations %&gt;% bind_rows()</code></pre>
<p>P.S. Check out <a href="https://www.google.com/culturalinstitute/beta/entity/m0bskv2">Google Art and Culture project</a>.</p>
</div>

    </article>
  </div>

  
  
  

  

  
</body>

</html>
